{% extends "base.html" %}

{% block title %}Settings - Blunder Tutor{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/settings.css">
{% endblock %}

{% block body %}
<div class="container">
  <a href="/" class="back-link">&larr; Back to Trainer</a>

  <div class="card">
    <h1>Settings</h1>
    <p class="subtitle">Manage your chess usernames</p>

    <div class="alert alert-info visible">
      At least one username is required to continue training.
    </div>

    <div class="alert alert-error" id="errorAlert"></div>
    <div class="alert alert-success" id="successAlert"></div>

    <form id="settingsForm">
      <div class="form-group">
        <label for="lichess">Lichess Username</label>
        <input type="text" id="lichess" name="lichess" placeholder="Enter your Lichess username" value="{{ lichess_username or '' }}">
        <div class="help-text">Optional: Leave blank if you don't use Lichess</div>
      </div>

      <div class="form-group">
        <label for="chesscom">Chess.com Username</label>
        <input type="text" id="chesscom" name="chesscom" placeholder="Enter your Chess.com username" value="{{ chesscom_username or '' }}">
        <div class="help-text">Optional: Leave blank if you don't use Chess.com</div>
      </div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--border);">

      <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Automatic Sync</h2>

      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="autoSync" name="autoSync" style="width: auto;">
          Enable automatic sync
        </label>
        <div class="help-text">Automatically fetch new games at regular intervals</div>
      </div>

      <div class="form-group">
        <label for="syncInterval">Sync Interval</label>
        <select id="syncInterval" style="width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px;">
          <option value="6">Every 6 hours</option>
          <option value="12">Every 12 hours</option>
          <option value="24" selected>Every 24 hours</option>
          <option value="48">Every 48 hours</option>
        </select>
      </div>

      <div class="form-group">
        <label for="maxGames">Max Games per Sync</label>
        <input type="number" id="maxGames" min="100" max="10000" value="1000" style="width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px;">
        <div class="help-text">Maximum number of games to fetch during each sync</div>
      </div>

      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="autoAnalyze" name="autoAnalyze" checked style="width: auto;">
          Automatically analyze new games
        </label>
        <div class="help-text">Run analysis on newly fetched games</div>
      </div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--border);">

      <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Training Settings</h2>

      <div class="form-group">
        <label for="spacedRepetitionDays">Spaced Repetition Interval (days)</label>
        <input type="number" id="spacedRepetitionDays" min="1" max="365" value="30" style="width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px;">
        <div class="help-text">Don't show correctly solved puzzles again for this many days</div>
      </div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--border);">

      <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Board Appearance</h2>
      <p class="help-text" style="margin-bottom: 16px;">Customize the chessboard colors and piece set.</p>

      <div class="board-preview-container">
        <div class="board-preview" id="boardPreview"></div>

        <div class="board-settings-controls">
          <label class="theme-section-title" style="margin-top: 0;">Piece Set</label>
          <div class="piece-set-grid" id="pieceSetGrid"></div>

          <label class="theme-section-title">Board Colors</label>
          <div class="board-color-presets" id="boardColorPresets"></div>

          <div class="board-custom-colors">
            <div class="form-group" style="margin-bottom: 0;">
              <label for="boardLightColor">Light Squares</label>
              <div class="color-input-row">
                <input type="color" id="boardLightColor" value="#f0d9b5">
                <input type="text" id="boardLightHex" value="#f0d9b5" maxlength="7" class="color-hex-input">
              </div>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label for="boardDarkColor">Dark Squares</label>
              <div class="color-input-row">
                <input type="color" id="boardDarkColor" value="#b58863">
                <input type="text" id="boardDarkHex" value="#b58863" maxlength="7" class="color-hex-input">
              </div>
            </div>
          </div>

          <button type="button" class="btn btn-secondary" id="resetBoardBtn" style="margin-top: 12px;">Reset to Defaults</button>
        </div>
      </div>

      <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--border);">

      <h2 style="font-size: 1.25rem; margin-bottom: 16px;">Theme Colors</h2>
      <p class="help-text" style="margin-bottom: 16px;">Choose a preset or customize individual colors.</p>

      <div class="theme-colors">
        <div class="preset-selector">
          <label class="theme-section-title" style="margin-top: 0;">Presets</label>
          <div class="preset-grid" id="presetGrid"></div>
        </div>

        <h3 class="theme-section-title">Accent Colors</h3>
        <div class="color-grid">
          <div class="form-group">
            <label for="themePrimary">Primary</label>
            <div class="color-input-row">
              <input type="color" id="themePrimary" value="#4f6d7a">
              <input type="text" id="themePrimaryHex" value="#4f6d7a" maxlength="7" class="color-hex-input">
            </div>
            <div class="help-text">Buttons, links, navigation</div>
          </div>

          <div class="form-group">
            <label for="themeSuccess">Success</label>
            <div class="color-input-row">
              <input type="color" id="themeSuccess" value="#3d8b6e">
              <input type="text" id="themeSuccessHex" value="#3d8b6e" maxlength="7" class="color-hex-input">
            </div>
            <div class="help-text">Positive feedback, completed</div>
          </div>

          <div class="form-group">
            <label for="themeError">Error</label>
            <div class="color-input-row">
              <input type="color" id="themeError" value="#c25450">
              <input type="text" id="themeErrorHex" value="#c25450" maxlength="7" class="color-hex-input">
            </div>
            <div class="help-text">Errors, blunder highlighting</div>
          </div>

          <div class="form-group">
            <label for="themeWarning">Warning</label>
            <div class="color-input-row">
              <input type="color" id="themeWarning" value="#b8860b">
              <input type="text" id="themeWarningHex" value="#b8860b" maxlength="7" class="color-hex-input">
            </div>
            <div class="help-text">Warnings, user moves</div>
          </div>
        </div>

        <h3 class="theme-section-title">Game Phase Colors</h3>
        <div class="color-grid">
          <div class="form-group">
            <label for="themePhaseOpening">Opening</label>
            <div class="color-input-row">
              <input type="color" id="themePhaseOpening" value="#5b8a9a">
              <input type="text" id="themePhaseOpeningHex" value="#5b8a9a" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themePhaseMiddlegame">Middlegame</label>
            <div class="color-input-row">
              <input type="color" id="themePhaseMiddlegame" value="#9a7b5b">
              <input type="text" id="themePhaseMiddlegameHex" value="#9a7b5b" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themePhaseEndgame">Endgame</label>
            <div class="color-input-row">
              <input type="color" id="themePhaseEndgame" value="#7a5b9a">
              <input type="text" id="themePhaseEndgameHex" value="#7a5b9a" maxlength="7" class="color-hex-input">
            </div>
          </div>
        </div>

        <h3 class="theme-section-title">Background & Text</h3>
        <div class="color-grid">
          <div class="form-group">
            <label for="themeBg">Page Background</label>
            <div class="color-input-row">
              <input type="color" id="themeBg" value="#f1f5f9">
              <input type="text" id="themeBgHex" value="#f1f5f9" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeBgCard">Card Background</label>
            <div class="color-input-row">
              <input type="color" id="themeBgCard" value="#ffffff">
              <input type="text" id="themeBgCardHex" value="#ffffff" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeText">Text</label>
            <div class="color-input-row">
              <input type="color" id="themeText" value="#1e293b">
              <input type="text" id="themeTextHex" value="#1e293b" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeTextMuted">Muted Text</label>
            <div class="color-input-row">
              <input type="color" id="themeTextMuted" value="#64748b">
              <input type="text" id="themeTextMutedHex" value="#64748b" maxlength="7" class="color-hex-input">
            </div>
          </div>
        </div>

        <h3 class="theme-section-title">Activity Heatmap</h3>
        <div class="color-grid">
          <div class="form-group">
            <label for="themeHeatmapEmpty">Empty</label>
            <div class="color-input-row">
              <input type="color" id="themeHeatmapEmpty" value="#ebedf0">
              <input type="text" id="themeHeatmapEmptyHex" value="#ebedf0" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeHeatmapL1">Level 1</label>
            <div class="color-input-row">
              <input type="color" id="themeHeatmapL1" value="#9be9a8">
              <input type="text" id="themeHeatmapL1Hex" value="#9be9a8" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeHeatmapL2">Level 2</label>
            <div class="color-input-row">
              <input type="color" id="themeHeatmapL2" value="#40c463">
              <input type="text" id="themeHeatmapL2Hex" value="#40c463" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeHeatmapL3">Level 3</label>
            <div class="color-input-row">
              <input type="color" id="themeHeatmapL3" value="#30a14e">
              <input type="text" id="themeHeatmapL3Hex" value="#30a14e" maxlength="7" class="color-hex-input">
            </div>
          </div>

          <div class="form-group">
            <label for="themeHeatmapL4">Level 4</label>
            <div class="color-input-row">
              <input type="color" id="themeHeatmapL4" value="#216e39">
              <input type="text" id="themeHeatmapL4Hex" value="#216e39" maxlength="7" class="color-hex-input">
            </div>
          </div>
        </div>

        <div class="theme-preview">
          <div class="preview-label">Preview</div>
          <div class="preview-buttons">
            <button type="button" class="btn preview-primary">Primary</button>
            <button type="button" class="btn btn-success preview-success">Success</button>
            <button type="button" class="btn btn-danger preview-error">Error</button>
            <span class="status preview-warning" style="background: var(--color-warning-bg); color: var(--color-warning);">Warning</span>
          </div>
          <div class="preview-phases">
            <span class="phase-pill opening">Opening</span>
            <span class="phase-pill middlegame">Middlegame</span>
            <span class="phase-pill endgame">Endgame</span>
          </div>
          <div class="preview-heatmap">
            <div class="preview-heatmap-label">Activity Heatmap</div>
            <div class="preview-heatmap-grid">
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
              </div>
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-1"></div>
              </div>
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-4"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
              </div>
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-4"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-4"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-1"></div>
              </div>
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-3"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-1"></div>
              </div>
              <div class="preview-heatmap-week">
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-2"></div>
                <div class="preview-heatmap-cell level-1"></div>
                <div class="preview-heatmap-cell level-0"></div>
                <div class="preview-heatmap-cell level-0"></div>
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-secondary" id="resetThemeBtn" style="margin-top: 12px;">Reset to Defaults</button>
      </div>

      <div class="btn-row" style="margin-top: 32px;">
        <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">Cancel</button>
        <button type="submit" class="btn btn-primary" id="submitBtn">Save Changes</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/settings.js"></script>
{% endblock %}
